#!/usr/bin/env mage
# Complete Dotfiles Management Demo
# This script demonstrates all key concepts for dotfiles management with Mage

conjure user_name = "Andre"
conjure dotfiles_repo = "https://github.com/your-username/dotfiles.git"
conjure dotfiles_dir = "$HOME/.dotfiles"

incant "🧙‍♂️ Welcome to the Complete Dotfiles Demo, $user_name!"
incant "✨ This demonstrates how to use Mage for dotfiles management"

# === SYSTEM DETECTION ===
incant ""
incant "🔍 STEP 1: System Detection"
incant "Detecting your operating system and environment..."

evoke "ver 2>nul && echo OS: Windows || echo OS: Unix-like"

incant "👤 Current user:"
evoke "whoami"

incant "📂 Current working directory:"
evoke "cd"

incant "🏠 Home directory:"
evoke "echo %USERPROFILE% 2>nul || echo $HOME"

# === PACKAGE MANAGER DETECTION ===
incant ""
incant "📦 STEP 2: Package Manager Detection"
incant "Checking what package managers are available..."

evoke "choco --version 2>nul && echo ✅ Chocolatey available || echo ❌ Chocolatey not found"
evoke "winget --version 2>nul && echo ✅ Winget available || echo ❌ Winget not found"
evoke "brew --version 2>/dev/null && echo ✅ Homebrew available || echo ❌ Homebrew not found"
evoke "apt --version 2>/dev/null && echo ✅ APT available || echo ❌ APT not found"

# === GIT CONFIGURATION ===
incant ""
incant "🌱 STEP 3: Git Configuration Check"
incant "Checking your Git setup..."

evoke "git --version 2>nul || echo Git not installed"
evoke "git config --global user.name 2>nul && echo Git user: $(git config --global user.name) || echo No Git user configured"
evoke "git config --global user.email 2>nul && echo Git email: $(git config --global user.email) || echo No Git email configured"

# === DOTFILES REPOSITORY CHECK ===
incant ""
incant "📁 STEP 4: Dotfiles Repository Check"
incant "Checking if dotfiles repository exists..."

evoke "ls -la $dotfiles_dir 2>/dev/null || dir $dotfiles_dir 2>nul || echo Dotfiles directory not found at $dotfiles_dir"

# === CONFIGURATION DEMONSTRATION ===
incant ""
incant "⚙️ STEP 5: Configuration Management Demo"
incant "Demonstrating how to manage different environments..."

conjure work_email = "work@company.com"
conjure personal_email = "personal@gmail.com"

incant "Work email would be: $work_email"
incant "Personal email would be: $personal_email"

# === BACKUP DEMONSTRATION ===
incant ""
incant "💾 STEP 6: Backup Strategy Demo"
incant "Showing how to backup existing configurations..."

conjure backup_dir = "%USERPROFILE%\\.config-backup-demo"
incant "Creating demo backup directory: $backup_dir"

evoke "mkdir $backup_dir 2>nul || mkdir -p ~/.config-backup-demo 2>/dev/null"
evoke "echo Demo backup file > %USERPROFILE%\\.config-backup-demo\\demo.txt 2>nul || echo Demo backup file > ~/.config-backup-demo/demo.txt 2>/dev/null"
evoke "dir %USERPROFILE%\\.config-backup-demo 2>nul || ls -la ~/.config-backup-demo 2>/dev/null"

# === SYMLINK DEMONSTRATION ===
incant ""
incant "🔗 STEP 7: Symlink Strategy Demo"
incant "Demonstrating how symlinks would be created..."

incant "On Unix systems, you would run:"
incant "  ln -sf ~/.dotfiles/bash/.bashrc ~/.bashrc"
incant "  ln -sf ~/.dotfiles/git/.gitconfig ~/.gitconfig"

incant "On Windows systems, you would run:"
incant "  mklink %USERPROFILE%\\.bashrc %USERPROFILE%\\.dotfiles\\bash\\.bashrc"
incant "  mklink %USERPROFILE%\\.gitconfig %USERPROFILE%\\.dotfiles\\git\\.gitconfig"

# === ENVIRONMENT VARIABLES ===
incant ""
incant "🌐 STEP 8: Environment Variables"
incant "Key environment variables for dotfiles management:"

evoke "echo HOME: %USERPROFILE% 2>nul || echo HOME: $HOME"
evoke "echo CONFIG: %LOCALAPPDATA% 2>nul || echo CONFIG: $HOME/.config"
evoke "echo SHELL: %COMSPEC% 2>nul || echo SHELL: $SHELL"

# === CLEANUP ===
incant ""
incant "🧹 STEP 9: Cleanup"
incant "Cleaning up demo files..."

evoke "rmdir /s /q %USERPROFILE%\\.config-backup-demo 2>nul || rm -rf ~/.config-backup-demo 2>/dev/null || echo Cleanup completed"

# === SUMMARY ===
incant ""
incant "📋 SUMMARY: Complete Dotfiles Management with Mage"
incant "=============================================="
incant ""
incant "✅ System detection and environment setup"
incant "✅ Package manager detection and installation"
incant "✅ Git configuration management"
incant "✅ Dotfiles repository handling"
incant "✅ Configuration file management"
incant "✅ Backup and restore strategies"
incant "✅ Cross-platform symlink creation"
incant "✅ Environment variable handling"
incant ""
incant "🎯 Next Steps:"
incant "1. Create your dotfiles repository: git clone $dotfiles_repo $dotfiles_dir"
incant "2. Organize configs in folders: bash/, zsh/, git/, nvim/, etc."
incant "3. Create environment-specific .mageconfig files"
incant "4. Write mage scripts for setup, maintenance, and syncing"
incant "5. Test on different systems and environments"
incant ""
incant "🧙‍♂️ Happy dotfiles management with Mage! ✨" 