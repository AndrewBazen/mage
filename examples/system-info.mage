#!/usr/bin/env mage
# ðŸ§™â€â™‚ï¸ Mage Built-in Functions Demo
# This demonstrates the powerful cross-platform built-in functions

incant "ðŸ”® Mage Built-in Functions Demo"
incant "=================================="

# System Information
incant ""
incant "ðŸ“Š System Information:"
cast platform()
cast architecture()
cast home_directory()
cast current_directory()

# Environment Variables
incant ""
incant "ðŸŒ Environment:"
cast env_var("USER", "unknown")
cast env_var("HOME")
cast env_var("PATH")

# Package Manager Detection
incant ""
incant "ðŸ“¦ Package Management:"
cast detect_package_managers()
cast get_primary_package_manager()

# Check specific package managers
scry cast package_manager_available("brew") {
    incant "âœ… Homebrew is available"
} lest {
    incant "âŒ Homebrew not found"
}

scry cast package_manager_available("apt") {
    incant "âœ… APT is available"
} lest {
    incant "âŒ APT not found"
}

# File System Operations
incant ""
incant "ðŸ“ File System Operations:"

# Create test directory
conjure test_dir = "mage-test"
incant "Creating test directory: $test_dir"
cast ensure_directory(test_dir)

# Check if directory exists
scry cast directory_exists(test_dir) {
    incant "âœ… Test directory created successfully"
} lest {
    incant "âŒ Failed to create test directory"
}

# Create a test file
conjure test_file = "mage-test/test.txt"
incant "Creating test file: $test_file"
evoke "echo 'Hello from Mage!' > '$test_file'"

# Check if file exists
scry cast file_exists(test_file) {
    incant "âœ… Test file created successfully"
} lest {
    incant "âŒ Test file was not created"
}

# Copy file
conjure backup_file = "mage-test/test-backup.txt"
incant "Copying file to: $backup_file"
cast copy_file(test_file, backup_file)

# Make executable (on Unix systems)
scry cast platform() != "windows" {
    incant "Making file executable..."
    cast make_executable(test_file)
    
    scry cast is_executable(test_file) {
        incant "âœ… File is now executable"
    } lest {
        incant "âŒ Failed to make file executable"
    }
}

# Symlink operations
conjure link_path = "mage-test/test-link.txt"
incant "Creating symlink: $link_path"
cast symlink(test_file, link_path)

scry cast file_exists(link_path) {
    incant "âœ… Symlink created successfully"
} lest {
    incant "âŒ Failed to create symlink"
}

# Package Management Demo (commented out to avoid installing packages)
incant ""
incant "ðŸ“¦ Package Management Demo:"
incant "(Package installation commands are commented out for safety)"

# Uncomment these lines to test package installation:
# scry cast package_installed("git") {
#     incant "âœ… Git is already installed"
# } lest {
#     incant "ðŸ“¦ Installing Git..."
#     cast install_package("git")
# }

# Network Operations Demo (commented out to avoid downloads)
incant ""
incant "ðŸŒ Network Operations Demo:"
incant "(Download commands are commented out for safety)"

# Uncomment to test file download:
# conjure download_file = "$test_dir/downloaded.txt"
# incant "Downloading test file..."
# cast download("https://httpbin.org/robots.txt", download_file)

# Cleanup
incant ""
incant "ðŸ§¹ Cleanup:"
incant "Removing test directory: $test_dir"
evoke "rm -rf '$test_dir' 2>/dev/null || rmdir /s /q '$test_dir' 2>nul"

incant ""
incant "ðŸŽ‰ Built-in Functions Demo Complete!"
incant "âœ¨ Mage provides cross-platform automation without shell wrappers!" 